var _debug=function(e){},genKeyPair=function(){var e=$("#name").val(),a=$("#email").val()?" <"+$("#email").val()+">":"",t=""!=$("#comments").val()?" ("+$("#comments").val()+")":"",s=parseInt($("#bitlength").val()),n=$("#algorithm").val(),l=$("#expire").val(),r=$("#passphrase").val();if("1"==l)var l=31536e3;else if("2"==l)var l=63072e3;else if("4"==l)var l=126144e3;else if("8"==l)var l=252288e3;var i=!1;"ecc"==n&&(i=!0);var u=calcSubkeySize(n,s);_debug("Params:"),_debug("Name: "+e),_debug("Email: "+a),_debug("Comments: "+t),_debug("Bitlength: "+s),_debug("Subkey Bitlength: "+u),_debug("Algorithm: "+n),_debug("Expire: "+l),_debug("use_ecc flag: "+i),_debug("Passphrase: "+r),_debug("Update buttons"),$("#generate_keys_btn").css("pointer-events","none"),$("#generate_keys_btn").addClass("disabled"),$("#generate_keys_btn").val("Generating .");var c=new kbpgp.ASP({progress_hook:function(e){_debug("progress_hook received: "+e);var a=$("#btn_update_ts");if(!(Date.now()-a.val()<500)){var t=$("#generate_keys_btn");"Generating ."==t.val()?t.val("Generating .."):"Generating .."==t.val()?t.val("Generating ..."):t.val("Generating ."),a.val(Date.now())}}}),d=kbpgp.const.openpgp,o={asp:c,userid:e+t+a,ecc:i,primary:{nbits:s,flags:d.certify_keys|d.sign_data|d.auth|d.encrypt_comm|d.encrypt_storage,expire_in:l},subkeys:[{nbits:u,flags:d.sign_data,expire_in:l},{nbits:u,flags:d.encrypt_comm|d.encrypt_storage,expire_in:l},]};_debug("Calling KeyManager.generate()"),kbpgp.KeyManager.generate(o,function(e,a){if(!e){_debug("Callback invoked()");var t=$("#passphrase").val();a.sign({},function(e){_debug(a),$("#key_short_id").val(a.get_pgp_short_key_id()),_debug("KeyID: "+a.get_pgp_short_key_id()),a.export_pgp_private_to_client({passphrase:t},function(e,a){_debug("private key: "+a),$("#privkey").val(a),$("#download_priv_key").removeClass("disabled")}),a.export_pgp_public({},function(e,a){_debug("public key: "+a),$("#pubkey").val(a),$("#download_pub_key").removeClass("disabled")})})}$("#generate_keys_btn").removeClass("disabled"),$("#generate_keys_btn").removeClass("btn-primary").addClass("btn-success"),$("#generate_keys_btn").val("Finished"),$("#start_again_btn").removeClass("hide").fadeIn()})},calcSubkeySize=function(e,a){if("rsa"==e)return a;if("ecc"!=e)return _debug("ERROR: Unexpected algorithm found!"),0;switch(a){case 256:return 163;case 384:return 256;case 512:return 384;default:return _debug("ERROR: Unexpected bitlength found for ECC algorithm!"),0}},populateKeysizeDropdown=function(){rsa_bitlengths=[{value:"",class:"disabled",text:"Select key size...",selected:"selected"},{value:"1024",class:null,text:"1024 bits (good for testing purposes)",selected:null},{value:"2048",class:null,text:"2048 bits (secure)",selected:null},{value:"4096",class:null,text:"4096 bits (more secure) [Recommended]",selected:null},{value:"8192",class:null,text:"8192 bits (super secure, super slow)",selected:null},],ecc_bitlengths=[{value:"",class:"disabled",text:"Select key size...",selected:"selected"},{value:"384",class:null,text:"384 bits (secure)",selected:null},],$("#bitlength > option").each(function(){$(this).remove()});var e=$("#bitlength"),a=$("#algorithm").val();"rsa"==a?$.each(rsa_bitlengths,function(a,t){$("<option />",{value:t.value,text:t.text,class:t.class,selected:t.selected}).appendTo(e)}):"ecc"==a&&$.each(ecc_bitlengths,function(a,t){$("<option />",{value:t.value,text:t.text,class:t.class,selected:t.selected}).appendTo(e)})},downloadPubKey=function(){var e=new Blob([$("#pubkey").val()],{type:"text/plain;charset=utf-8"});return saveAs(e,"0x"+$("#key_short_id").val()+"-pub.asc"),!1},downloadPrivKey=function(){var e=new Blob([$("#privkey").val()],{type:"text/plain;charset=utf-8"});return saveAs(e,"0x"+$("#key_short_id").val()+"-sec.asc"),!1};